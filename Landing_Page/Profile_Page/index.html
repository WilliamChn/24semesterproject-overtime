<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile Page</title>
<link rel="stylesheet" href="style.css">
<script>
// This function will fetch the protein intake from the profile-data.php
function fetchIntakes() {
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var response = JSON.parse(this.responseText);
            document.getElementById('proteinIntake').innerText = response.totalProtein + ' g';
            document.getElementById('waterIntakeDisplay').innerText = response.totalWater + ' ml';
            document.getElementById('calorieIntake').innerText = response.totalCalories + ' cal'; // Add this line
            updateWaterIntakeCircle(response.totalWater);
            updateProteinIntakeCircle(response.totalProtein);
        }
    };
    xhr.open('GET', 'profile-data.php', true);
    xhr.send();
}

function updateProteinIntakeCircle(value) {
    var maxProtein = 200; // Set a maximum protein intake value for full circle
    var percentage = Math.min(value / maxProtein * 100, 100);
    var circle = document.getElementById('proteinIntakeCircle');
    circle.style.background = `conic-gradient(lightgreen 0% ${percentage}%, lightgray ${percentage}% 100%)`;

    // Show goal message if reached
    var goalMessage = document.getElementById('proteinGoalMessage');
    goalMessage.style.display = (value >= maxProtein) ? 'block' : 'none';
}

function updateWaterIntakeCircle(value) {
    var maxWater = 200;
    var percentage = Math.min(value / maxWater * 100, 100); // Calculate the fill percentage
    var circle = document.getElementById('waterIntakeCircle');
    circle.style.background = `conic-gradient(lightblue 0% ${percentage}%, lightgray ${percentage}% 100%)`;

    // Show goal message if reached
    var goalMessage = document.getElementById('waterGoalMessage');
    goalMessage.style.display = (value >= maxWater) ? 'block' : 'none';
}

// Function to send water intake data to the server
function sendWaterIntakeData(waterIntake) {
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "profile-data.php", true);
    xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            fetchIntakes(); // Refetch intakes to update the display and the circle
        }
    };
    xhr.send("waterIntake=" + waterIntake);
}


// Function to validate the water intake input and send data if valid
function validateAndSendWaterIntake() {
    var waterIntakeInput = document.getElementById('waterIntakeInput');
    var waterIntakeValue = waterIntakeInput.value;
    if (isNaN(waterIntakeValue) || waterIntakeValue < 0 || waterIntakeValue === '') {
        alert('Please enter a valid number');
        waterIntakeInput.value = ''; // Clear the textbox
        waterIntakeInput.focus();
        return false;
    }
    sendWaterIntakeData(waterIntakeValue); // Send data if validation is successful
    waterIntakeInput.value = ''; // Clear the input box after sending data
}


// Call the function on window load
window.onload = fetchIntakes;
</script>
</head>
<body>

    <header>
      <div class="navbar">
        <a href="../index.php">OVERTIME</a>
        <div class="navbar-right">
          <a href="../Meal_Page/index.html">Log Meals</a>
          <a href="../Workout_Page/index.html">Log Workouts</a>
          <a href="../Profile_Page/index.html">Profile</a>
          <a href="../logout.php">Logout</a> 
        </div>
      </div>
    </header>
    
    <!-- Profile Header -->
    <div class="profile-header">
        <div class="header-content">
            <h1>MY PROFILE</h1>
        </div>
    </div>

    <!-- Profile Sections Container -->
    <div class="sections-container">

    <!-- Personal Section -->
      <div class="section personal">
        <h2 class="section-title">Personal</h2>
        <div class="data-field-container">
            <div class="data-field">
                <span class="data-label">Water Intake</span>
                <input type="text" id="waterIntakeInput" placeholder="Enter ml">
                <button type="button" onclick="validateAndSendWaterIntake()">Enter</button>
                <span class="data-value" id="waterIntakeDisplay">0 ml</span>
                <div class="circle-progress" id="waterIntakeCircle"></div>
                <div class="goal-message" id="waterGoalMessage">Daily Goal Reached</div>
            </div>
            <div class="data-field">
                <span class="data-label">Protein Intake</span>
                <span class="data-value" id="proteinIntake">0 g</span>
                <div class="circle-progress" id="proteinIntakeCircle"></div>
                <div class="goal-message" id="proteinGoalMessage">Daily Goal Reached</div>
            </div>            
        </div>
        <div class="data-field-container">
            <div class="data-section">
                <span class="data-label">Calorie Intake</span>
                <span class="data-value" id="calorieIntake">0 cal</span> <!-- Add this line -->
            </div>
          <div class="data-section">
              <span class="data-label">Weight</span>
              <span class="data-value">150 lbs</span>
          </div>
      </div>
  </div>

        <!-- Exercise Section -->
        <div class="section exercise">
          <h2 class="section-title">Exercise</h2>
          <div class="data-field-container">
              <div class="data-section">
                  <span class="data-label">Max Weight Lifted</span>
                  <span class="data-value">250 lbs</span>
              </div>
              <div class="data-section">
                  <span the="data-label">Longest Workout</span>
                  <span class="data-value">2 hrs</span>
              </div>
          </div>
      </div>
  </div>

</body>
</html>
