<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Log</title>
    <style>
      body {
        font-family: Arial, sans-serif;
      }
      .header {
        display: flex;
        justify-content: space-between;
        padding: 20px;
        background-color: #333;
        color: white;
      }
      .container {
        display: flex;
        justify-content: space-between;
        margin: 20px;
      }
      .workout-list, .add-entry {
        flex: 1;
        margin: 10px;
      }
      .workout-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
        padding: 10px;
        background-color: #f2f2f2;
      }
      .workout-item > span {
        flex: 1;
    
      }
      .workout-item > button {
        background-color: red;
        color: white;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        
      }
      .workout-item > button2 {
        padding: 10px 15px; /* Adjust padding to make the button smaller */
      font-size: 14px; /* Adjust font size if needed */
      background-color: #000; /* Set background color to black */
      color: white;
      border: none;
      cursor: pointer;
      /* Add any additional styling as needed */
      }
      .add-entry-button {
        display: block;
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        background-color: #4CAF50;
        color: white;
        border: none;
        cursor: pointer;
      
      }
      .navbar {
        background-color: #ffffff; /* White background */
        overflow: hidden;
        padding: 10px 20px;
    }
    
    .navbar a {
        float: left;
        display: block;
        color: black; /* Black text color */
        text-align: center;
        padding: 12px;
        text-decoration: none;
        font-size: 18px; /* Larger font size */
    }
    
    .navbar a:hover {
        color: #777; /* Dark grey color on hover */
    }
    
    .navbar a:not(:first-child) {
        margin-left: 10px;
    }
    
    .navbar-right {
        float: right;
    }
    .header-image {
        background-image: url('workout.png'); /* Replace with your image path */
        background-size: cover;
        background-position: center;
        height: 150px; /* Adjust the height as needed */
        display: flex;
        align-items: center;
        justify-content: center;
        color: #000; /* black text color */
      }
      .workout-select, .workout-duration {
        flex: 1;
        margin-right: 10px;
        padding: 5px 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background-color: white;
      }
    
      .workout-duration {
        flex: 0 0 100px; /* Adjust the width as necessary */
      }
    
      .workout-duration-label {
        margin-right: 10px;
      }
    </style>
</head>
<body>

  <div class="navbar">
    <a href="../index.php">OVERTIME</a>
    <div class="navbar-right">
        <a href="../Meal_Page/index.html">Log Meals</a>
        <a href="../Workout_Page/index.html">Log Workouts</a>
        <a href="../Profile_Page/index.html">Profile</a>
    </div>
</div>

<div class="header-image">
    <h1>WORKOUTS</h1>
</div>

<div class="container">
    <div class="workout-list">
        <!-- Workout items will be dynamically added here -->
    </div>
    <div class="add-entry">
        <button id="add-entry-button" class="add-entry-button">Add Entry</button>
    </div>
    <div class="delete-entry">
        <select id="delete-workout-select" class="workout-select"></select>
        <button id="delete-workout-button" class="delete-entry-button">Delete Selected Workout</button>
    </div>
</div>

<script>
// Function to create a new workout entry
function createWorkoutItem(id, workoutTypeValue, workoutDurationValue) {
    const workoutList = document.querySelector('.workout-list');
    
    // Create the workout item div
    const workoutItem = document.createElement('div');
    workoutItem.classList.add('workout-item');
    workoutItem.dataset.id = id; // Assign an ID to each workout item
    
    // Create the select dropdown
    const select = document.createElement('select');
    select.name = 'workouts';
    select.classList.add('workout-select');
    select.innerHTML = `
        <option value="squats">Squats</option>
        <option value="pull-ups">Pull-ups</option>
        <option value="sit-ups">Sit-ups</option>
        <!-- Add more workout options here -->
    `;
    select.value = workoutTypeValue; // Set the default or existing value
    
    // Create the duration label and input
    const durationLabel = document.createElement('span');
    const durationInput = document.createElement('input');
    durationLabel.classList.add('workout-duration-label');
    durationLabel.textContent = 'Duration:';
    durationInput.type = 'number';
    durationInput.classList.add('workout-duration');
    durationInput.value = workoutDurationValue; // Set the default or existing value
    
    // Create the delete button
    const deleteButton = document.createElement('button');
    deleteButton.textContent = 'x';
    deleteButton.onclick = function() {
    if (confirm("Are you sure you want to delete the most recent workout? This cannot be undone!")) {
        fetch('delete_workout.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'delete_workout=true'
        })
        .then(response => response.text())
        .then(data => {
            console.log(data); // Log the server response for debugging
            console.log(id);
            // Remove the most recent workout item from the DOM
            const workoutList = document.querySelector('.workout-list');
            const lastWorkoutItem = workoutList.lastElementChild;
            if (lastWorkoutItem) {
                workoutList.removeChild(lastWorkoutItem);
            }
            alert('Most recent workout deleted successfully!');
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
};

    
const saveButton = document.createElement('button2');
  saveButton.textContent = 'Save';
  // In your JavaScript function where the Save button is created
saveButton.classList.add('save-entry-button'); // This is a new class for the save button
  
  // Corrected save button click function
  saveButton.onclick = function() {
  const workoutStyle = select.value;
  const workoutDuration = durationInput.value;
  const data = `style=${encodeURIComponent(workoutStyle)}&duration=${encodeURIComponent(workoutDuration)}`;

  fetch('save_workout.php', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: data,
  })
  .then(response => response.text())
  .then(responseData => {
    alert('Workout saved successfully!');
    // Call populateDeleteDropdown here to refresh the dropdown list.
    populateDeleteDropdown();
    // Optionally, clear the input fields or update the UI accordingly
  })
  .catch((error) => {
    console.error('Error:', error);
  });
};



    
    // Append elements to the workout item
    workoutItem.appendChild(select);
    workoutItem.appendChild(durationLabel);
    workoutItem.appendChild(durationInput);
    workoutItem.appendChild(deleteButton);
    workoutItem.appendChild(saveButton); // Add the saveButton here

    
    // Append the workout item to the list
    workoutList.appendChild(workoutItem);
}

// Event listener for the Add Entry button
document.getElementById('add-entry-button').addEventListener('click', function() {
    // This would be where you get the values for the workout type and duration from the user
    // For now, let's add a static entry (you would replace this with actual data)
    createWorkoutItem(Date.now(), 'squats', 30); // Using Date.now() for unique ID placeholder
});

// Function to populate the workout delete dropdown
function populateDeleteDropdown() {
    fetch('get_workouts.php')
    .then(response => response.json())
    .then(workouts => {
        const deleteDropdown = document.getElementById('delete-workout-select');
        deleteDropdown.innerHTML = ''; // Clear existing options
        workouts.forEach(workout => {
            // Include both Style and Duration in the dropdown display
            const optionText = `${workout.Style} - ${workout.Duration} min`;
            const option = new Option(optionText, workout.ID);
            deleteDropdown.add(option);
        });
    })
    .catch(error => {
        console.error('Error:', error);
    });
}


// Event listener for the Delete Selected Workout button
document.getElementById('delete-workout-button').addEventListener('click', function() {
    const deleteDropdown = document.getElementById('delete-workout-select');
    const selectedWorkoutId = deleteDropdown.value;
    const selectedWorkoutText = deleteDropdown.options[deleteDropdown.selectedIndex].text;
    
    if (selectedWorkoutId && confirm(`Are you sure you want to delete this workout: ${selectedWorkoutText}? This cannot be undone!`)) {
        fetch('delete_workout.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `id=${encodeURIComponent(selectedWorkoutId)}`
        })
        .then(response => response.text())
        .then(data => {
            // Assuming the server sends back a success message
            if (data === "Workout deleted successfully") {
                // Remove the workout from the dropdown
                deleteDropdown.remove(deleteDropdown.selectedIndex);

                // Remove the workout from the workout list in the UI
                const workoutList = document.querySelector('.workout-list');
                const workoutItems = workoutList.querySelectorAll('.workout-item');
                workoutItems.forEach((item) => {
                    if (item.dataset.id === selectedWorkoutId) {
                        workoutList.removeChild(item);
                    }
                });
                
                // Display a confirmation message
                alert('Workout deleted successfully!');
            } else {
                // If the server did not confirm the deletion, alert the user
                alert(data);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert("There was a problem deleting the workout.");
        });
    }
});


document.addEventListener('DOMContentLoaded', populateDeleteDropdown);
</script>

</body>
</html>
